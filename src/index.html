 R"(
<!DOCTYPE HTML>

<html>

<head>

    <script type='text/javascript'>
        var points = [];
        var oldX = 0;
        var startX = 0;
        var maxY = 1;  
        var latency = 0;
        var latency_worst = 0;
        window.onmousemove = function(e) { m_pos_x = e.pageX;m_pos_y = e.pageY; }
        var m_pos_x,m_pos_y;
        var motor = 0;
        window.onmousedown = function(e) {motor=1;}
        window.onmouseup = function(e) {motor=0;}
        var ctx = canvas.getContext('2d');
        function resetWorstCaseLatency(){
            latency_worst=latency;
        }
        function sleep(ms) {
        return new Promise(resolve => setTimeout(resolve, ms));
        }
        function drawPoints(obj){
            ctx.lineTo(obj.x-startX,500*obj.y/maxY);
            ctx.moveTo(obj.x-startX,500*obj.y/maxY);
        }
        function draw(obj) {
            points.push(obj);
            var canvas = document.getElementById('canvas');    
            if (canvas.getContext) {
                
                ctx = canvas.getContext('2d');
                ctx.beginPath();
                ctx.moveTo(0, 0);
                ctx.clearRect(0, 0, 1000, 500);
                points.forEach(drawPoints);
                ctx.stroke();
            }
            if (points.length > 100) points.shift();
                startX = points[0].x;
            if (obj.y > maxY){
                maxY = obj.y;
            }
        }
        function sendYaw(){
            
        }

        function WebSocketTest() {

            var div = document.getElementById('RX');
            var latency_now = document.getElementById('latency');
            var latency_worstcase = document.getElementById('latency_worst');
            var y = document.getElementById('y');    
            
            
            if ("WebSocket" in window) {
                //alert('WebSocket is supported by your Browser!');

                // Let us open a web socket
                var ws = new WebSocket('ws://' + location.hostname + ':81/');
                ws.onopen = function () {
                    div.innerHTML="open."
                    // Web Socket is connected, send data using send()
                    ws.send('ok');
                    
                };
                ws.onmessage = function (evt) {

         

                    var received_msg = evt.data;
                    
                    var obj = JSON.parse(received_msg);
                    
                    latency = obj.x-oldX;
                    oldX = obj.x;
                    latency_now.innerHTML = latency;
                    if (latency > latency_worst){
                        latency_worst = latency;
                    }
                    latency_worstcase.innerHTML = latency_worst;

                    y.innerHTML = obj.y;

                    if (obj.msg != ''){
                        div.innerHTML += obj.msg;
                    }

                    draw(obj);
                    var outputmsg = '{"yaw":'+m_pos_x/10+', "speed":'+motor+'}';
                   ws.send(outputmsg);

                    


                };
                ws.onclose = function () {
                    div.innerHTML="closed."
                    ws = null
                    setTimeout(WebSocketTest, 25);     
                    // websocket is closed.
                    //alert('Connection is closed...');
                    
                };
                
            } else {

                // The browser doesn't support WebSocket
                alert('WebSocket NOT supported by your Browser!');
            }
        }
    </script>

</head>

<body onload='WebSocketTest();'>
    Latency (ms):
    <div id=latency></div>
    <br>
    Latency Worst Case (ms) [<a onclick='resetWorstCaseLatency();'>reset</a>]:
    
    <div id=latency_worst></div>    
    <br> y:
    <div id=y></div>
    <br>
    <div id='RX'></div>
    <canvas id=canvas width=2000 height=500 ></canvas> 

</body>
</html>
)"
